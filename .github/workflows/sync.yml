name: Sync CPython Issues to Project Board

on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    env:
      GH_TOKEN: ${{ secrets.PROJECT_PAT }}
    steps:
      - name: Debug auth
        run: gh auth status

      - name: Sync JIT issues and PRs
        run: |
          echo "Searching..."
          URLS=$(gh search issues --repo python/cpython --label topic-JIT --state open --limit 200 --json url --jq '.[].url')
          echo "Found: $URLS"
          echo "$URLS" | while read -r url; do
            echo "Adding $url"
            gh project item-add 10 --owner @me --url "$url"
          done

      - name: Sync WASI issues and PRs
        run: |
          echo "Searching..."
          URLS=$(gh search issues --repo python/cpython --label OS-wasi --state open --limit 200 --json url --jq '.[].url')
          echo "Found: $URLS"
          echo "$URLS" | while read -r url; do
            echo "Adding $url"
            gh project item-add 10 --owner @me --url "$url"
          done

      - name: Sync argparse issues and PRs
        run: |
          echo "Searching..."
          URLS=$(gh search issues --repo python/cpython --match title argparse --state open --limit 200 --json url --jq '.[].url')
          echo "Found: $URLS"
          echo "$URLS" | while read -r url; do
            echo "Adding $url"
            gh project item-add 10 --owner @me --url "$url"
          done