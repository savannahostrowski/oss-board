name: Sync CPython Issues to Project Board

on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    env:
      GH_TOKEN: ${{ secrets.PROJECT_PAT }}
    strategy:
      matrix:
        search:
          - type: issues
            args: --label topic-JIT
          - type: prs
            args: --label topic-JIT
          - type: issues
            args: --label OS-wasi
          - type: prs
            args: --label OS-wasi
          - type: issues
            args: --match title argparse
          - type: prs
            args: --match title argparse
          - type: prs
            args: --review-requested @me
    steps:
      - name: Sync ${{ matrix.search.type }} (${{ matrix.search.args }})
        run: |
          gh search ${{ matrix.search.type }} --repo python/cpython --state open --limit 200 ${{ matrix.search.args }} --json url --jq '.[].url' | while read -r url; do
            echo "Adding $url"
            gh project item-add 10 --owner @me --url "$url"
          done